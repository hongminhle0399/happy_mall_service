# Schema vs Mock Data Alignment - Fixed ✅

## Issue Found

Your mock data had a mismatch with your database schema after you updated the timestamp configuration.

## Problems Identified

### 1. ❌ `ordersData` had `orderDate` field

**Mock data had:**

```typescript
{
  customerId: 1,
  productId: 1,
  orderDate: new Date('2024-12-15T10:30:00Z'),  // ❌ This field doesn't exist!
  paymentMethodId: 'CREDIT_CARD',
}
```

**But your schema (`orders.entity.ts`) has:**

```typescript
export const ordersEntity = pgTable(TABLE_NAME, {
  id: integer().primaryKey().generatedAlwaysAsIdentity(),
  customerId: integer('customer_id').notNull(),
  productId: integer('product_id').notNull(),
  paymentMethodId: text('payment_method_id').notNull(),
  ...timestamps, // ← createdAt, updatedAt, deletedAt
});
```

**The schema uses `timestamps` (createdAt/updatedAt/deletedAt), NOT `orderDate`!**

---

## What Was Fixed

### ✅ Removed `orderDate` from `ordersData`

**Updated to:**

```typescript
{
  customerId: 1,
  productId: 1,
  paymentMethodId: 'CREDIT_CARD',
  // createdAt, updatedAt will be auto-generated by defaultNow()
}
```

---

## Why This Works

### Timestamp Auto-Generation

Your `timestamps` configuration in `common/index.ts`:

```typescript
export const timestamps = {
  createdAt: timestamp('created_at', { withTimezone: true, mode: 'string' })
    .defaultNow()
    .notNull(),
  updatedAt: timestamp('updated_at', { withTimezone: true, mode: 'string' })
    .defaultNow()
    .notNull()
    .$onUpdateFn(() => new Date().toISOString()),
  deletedAt: timestamp('deleted_at', { withTimezone: true, mode: 'string' }),
};
```

**What this means:**

- ✅ `createdAt` - Auto-generated when row is inserted (`.defaultNow()`)
- ✅ `updatedAt` - Auto-generated on insert, auto-updated on row update
- ✅ `deletedAt` - Nullable, for soft deletes
- ✅ All timestamps are timezone-aware (`withTimezone: true`)
- ✅ All timestamps return ISO strings (`mode: 'string'`)

**You don't need to provide these fields in mock data!**

---

## Schema Summary

### Entities Using Timestamps

| Entity               | Has Timestamps? | Auto-Generated Fields                 |
| -------------------- | --------------- | ------------------------------------- |
| `countries`          | ❌ No           | -                                     |
| `brands`             | ❌ No           | -                                     |
| `product_categories` | ❌ No           | -                                     |
| `payment_methods`    | ❌ No           | -                                     |
| `products`           | ✅ Yes          | `createdAt`, `updatedAt`, `deletedAt` |
| `customers`          | ✅ Yes          | `createdAt`, `updatedAt`, `deletedAt` |
| `inventory`          | ✅ Yes          | `createdAt`, `updatedAt`, `deletedAt` |
| `product_variants`   | ❌ No           | -                                     |
| `orders`             | ✅ Yes          | `createdAt`, `updatedAt`, `deletedAt` |
| `order_details`      | ❌ No           | -                                     |

---

## Mock Data Status - All Fixed ✅

| Mock Data Array         | Status       | Notes                                          |
| ----------------------- | ------------ | ---------------------------------------------- |
| `countriesData`         | ✅ Correct   | No timestamps needed                           |
| `brandsData`            | ✅ Correct   | No timestamps needed                           |
| `productCategoriesData` | ✅ Correct   | No timestamps needed                           |
| `productsData`          | ✅ Correct   | Timestamps auto-generated                      |
| `customersData`         | ✅ Correct   | Timestamps auto-generated                      |
| `paymentMethodsData`    | ✅ Correct   | No timestamps needed                           |
| `inventoryData`         | ✅ Correct   | Timestamps auto-generated                      |
| `productVariantsData`   | ✅ Correct   | No timestamps needed                           |
| `ordersData`            | ✅ **FIXED** | Removed `orderDate`, timestamps auto-generated |
| `orderDetailsData`      | ✅ Correct   | No timestamps needed                           |

---

## Next Steps

1. **Generate migration** (if needed):

   ```bash
   npx drizzle-kit generate
   ```

2. **Apply migration**:

   ```bash
   npx drizzle-kit push
   ```

3. **Run seed**:
   ```bash
   npm run db:seed
   ```

---

## Expected Database Behavior

When you insert an order:

```typescript
await db.insert(ordersEntity).values({
  customerId: 1,
  productId: 1,
  paymentMethodId: 'CREDIT_CARD',
});
```

**PostgreSQL will automatically add:**

```sql
INSERT INTO orders (customer_id, product_id, payment_method_id, created_at, updated_at)
VALUES (1, 1, 'CREDIT_CARD', NOW(), NOW());
```

**Result in database:**

```json
{
  "id": 1,
  "customerId": 1,
  "productId": 1,
  "paymentMethodId": "CREDIT_CARD",
  "createdAt": "2026-01-20T00:16:23+07:00", // ← Auto-generated with timezone!
  "updatedAt": "2026-01-20T00:16:23+07:00", // ← Auto-generated with timezone!
  "deletedAt": null
}
```

---

## Summary

✅ **Mock data now matches your schema perfectly!**
✅ **Timestamps will be auto-generated with timezone awareness**
✅ **No need to manually provide createdAt/updatedAt/deletedAt in seed data**
✅ **Ready to run migrations and seed the database**
